window.customElements.define("virtual-joystick",class t extends HTMLElement{static #a=':host{--radius:65px;--size:calc(var(--radius) * 2);--border:1px solid gray;--background-color:rgba(255, 255, 255, 0.3);--transition:opacity 1s,background-color .2s;--background-color-active:rgba(255, 255, 255, 0.6);--background-color-active-after:rgba(255, 255, 255, 0.8);--transition-active-after:transform .1s,background-color 0.2s;--size-before:50px;--border-before:1px solid rgb(139, 139, 139);--transform-before:translate(calc(-50% + var(--radius)), calc(-50% + var(--radius)));--size-after:50px;--border-after:1px solid gray;--background-color-after:rgba(255, 255, 255, 0.5);--transition-after:transform .4s,background-color .2s}.dynamic .joystick{opacity:0}.joystick{--x:var(--radius);--y:var(--radius);width:var(--size);height:var(--size);border:var(--border);background-color:var(--background-color);border-radius:50%;position:absolute;box-sizing:border-box;transition:var(--transition)}&:after,&:before{content:"";border-radius:50%;display:block;position:absolute}&:after{width:var(--size-after);height:var(--size-after);border:var(--border-after);background-color:var(--background-color-after);transform:translate(calc(-50% + var(--x)),calc(-50% + var(--y)));transition:var(--transition-after)}&:before{width:var(--size-before);height:var(--size-before);border:var(--border-before);transform:var(--transform-before)}';static #b=t=>{let e=["ne","n","nw","w","sw","s","sw"],s=22.5;for(let i of e)if(t>=s&&t<(s+=45))return i;return"w"};static #c(e="",s=""){let i="";return!1===e.includes(s[0])&&(i=s[0],s[1]&&!1===e.includes(s[1])&&(i=s)),i}#d=()=>this.dispatchEvent(new CustomEvent("joypaddown"));#e=()=>this.dispatchEvent(new CustomEvent("joypadmove"));#f=()=>this.dispatchEvent(new CustomEvent("joypadup"));#g(o,r){this.#h.style.setProperty("--x",`${o}px`),this.#h.style.setProperty("--y",`${r}px`)}#i({clientX:a,clientY:n}){let{host:l}=this.shadowRoot,{lock:h}=this.dataset,d="x"===h?this.#j:a-l.offsetLeft-this.#h.offsetLeft,f="y"===h?this.#j:n-l.offsetTop-this.#h.offsetTop,c=d-this.#j,m=f-this.#j;return{dx:d,dy:f,dxr:c,dyr:m,hypot:Math.hypot(c,m)}}#k({degree:p=0,force:b=0,radian:u=0,distance:v=0,direction:y="",hypot:g=0,capture:$="",release:w="",x=this.#h.offsetWidth+this.#h.offsetLeft,y:k=this.#h.offsetTop+this.#h.offsetTop}){Object.assign(this.dataset,{degree:p,force:b,radian:u,distance:v,direction:y,hypot:g,capture:$,release:w,x,y:k})}#l(L){let{clientX:_,clientY:z}=L,{offsetLeft:E,offsetTop:C,offsetWidth:T,offsetHeight:j}=this;this.dataset.mode||(E+=this.#h.offsetLeft,C+=this.#h.offsetTop,T=this.#h.offsetWidth,j=this.#h.offsetHeight);let P=_>=E&&_<=E+T&&z>=C&&z<=C+j;return P}#j=0;#h=null;constructor(){super();let e={};this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<slot name="style"><style>${t.#a}</style></slot><slot name="aside"></slot><slot><div class="joystick"></div></slot>`,this.#h=this.shadowRoot.lastElementChild.firstElementChild,this.dataset.mode&&(this.shadowRoot.lastElementChild.classList.add("dynamic"),e={x:0,y:0}),this.dataset.shape&&this.shadowRoot.lastElementChild.classList.add("box"),this.#j=this.#h.offsetWidth/2,this.#k(e)}connectedCallback(){document.addEventListener("pointerdown",this.start)}start=t=>{let e,{clientX:s,clientY:i}=t,o=()=>{this.#h.classList.add("active"),this.#h.setPointerCapture(t.pointerId),this.bind(t,e,this.#d),this.#h.onpointermove=this.bind,this.#h.onpointerup=this.end};this.#l(t)&&(e=this.#i(t),this.dataset.mode?("semi"===this.dataset.mode&&this.#h.parentElement.classList.remove("dynamic"),this.#h.style.left=`${s-this.offsetLeft-this.#h.offsetWidth/2}px`,this.#h.style.top=`${i-this.offsetLeft-this.#h.offsetHeight/2}px`,o()):e.hypot<=this.#j&&o())};bind=(e,{dx:s,dy:i,dxr:o,dyr:r,hypot:a}=this.#i(e),n=this.#e)=>{let l=this.#j,h=Math.atan2(r,o),d=180*h/Math.PI,f=s,c=i;!this.dataset.shape&&a>l&&(f=l*Math.cos(h)+l,c=l*Math.sin(h)+l),d=(d>0?360:0)-d;let m=t.#b(d);this.#k({hypot:a,degree:d,direction:m,capture:t.#c(this.dataset.direction,m),release:t.#c(m,this.dataset.direction),x:f+this.#h.offsetLeft,y:c+this.#h.offsetTop,radian:(h>0?2*Math.PI:0)-h,distance:Math.min(a,l),force:a/l}),this.#g(f,c),n()};end=()=>{this.#h.classList.remove("active"),this.#k({}),this.#g(this.#j,this.#j),this.#h.onpointerup=this.#h.onpointermove=null,this.#f()}});